{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "sortable-list",
  "type": "registry:ui",
  "dependencies": [
    "@dnd-kit/core",
    "@dnd-kit/sortable",
    "@dnd-kit/utilities",
    "lucide-react"
  ],
  "registryDependencies": ["@shadcn/button"],
  "files": [
    {
      "path": "src/registry/default/ui/sortable-list.tsx",
      "content": "import {\n  type Active,\n  DndContext,\n  type DragEndEvent,\n  type DraggableAttributes,\n  type DraggableSyntheticListeners,\n  DragOverlay,\n  type DragStartEvent,\n  type DropAnimation,\n  defaultDropAnimationSideEffects,\n  KeyboardSensor,\n  PointerSensor,\n  type UniqueIdentifier,\n  useSensor,\n  useSensors,\n} from \"@dnd-kit/core\";\nimport {\n  arrayMove,\n  SortableContext,\n  sortableKeyboardCoordinates,\n  useSortable,\n} from \"@dnd-kit/sortable\";\nimport { CSS } from \"@dnd-kit/utilities\";\nimport { GripVertical } from \"lucide-react\";\nimport React from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { cn } from \"@/registry/default/lib/utils\";\nimport { Button } from \"@/registry/default/ui/button\";\n\nconst DRAG_OPACITY = 0.4;\n\ntype SortableBaseItem = {\n  id: UniqueIdentifier;\n};\n\ntype SortableListProps<TItem extends SortableBaseItem> = {\n  items: TItem[];\n  onChange: (items: TItem[]) => void;\n  renderItem: (\n    item: TItem,\n    index: number,\n    isOverlay?: boolean\n  ) => React.ReactNode;\n  className?: string;\n};\n\nconst SortableList = <TItem extends SortableBaseItem>({\n  items,\n  onChange,\n  renderItem,\n  className,\n}: SortableListProps<TItem>) => {\n  const [active, setActive] = React.useState<Active | null>(null);\n  const [mounted, setMounted] = React.useState(false);\n\n  React.useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  const [activeItem, activeIndex] = React.useMemo(() => {\n    if (active === null) {\n      return [null, null];\n    }\n\n    const index = items.findIndex(({ id }) => id === active.id);\n\n    return [items[index], index];\n  }, [active, items]);\n\n  const sensors = useSensors(\n    useSensor(PointerSensor),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    })\n  );\n\n  const handleDragStart = ({ active: activeEvent }: DragStartEvent) => {\n    setActive(activeEvent);\n  };\n\n  const handleDragEnd = ({ active: activeEvent, over }: DragEndEvent) => {\n    if (over && activeEvent.id !== over.id) {\n      const activeEventIndex = items.findIndex(\n        ({ id }) => id === activeEvent.id\n      );\n      const overIndex = items.findIndex(({ id }) => id === over.id);\n\n      onChange(arrayMove(items, activeEventIndex, overIndex));\n    }\n\n    setActive(null);\n  };\n\n  const handleDragCancel = () => {\n    setActive(null);\n  };\n\n  return (\n    <DndContext\n      onDragCancel={handleDragCancel}\n      onDragEnd={handleDragEnd}\n      onDragStart={handleDragStart}\n      sensors={sensors}\n    >\n      <SortableContext items={items}>\n        <ul\n          className={cn(\n            \"flex list-inside list-none list-image-none flex-col p-0\",\n            className\n          )}\n          role=\"application\"\n        >\n          {items.map((item, index) => (\n            <React.Fragment key={item.id}>\n              {renderItem(item, index)}\n            </React.Fragment>\n          ))}\n        </ul>\n      </SortableContext>\n      {mounted &&\n        createPortal(\n          <Overlay>\n            {activeItem && activeIndex !== null\n              ? renderItem(activeItem, activeIndex, true)\n              : null}\n          </Overlay>,\n          document.body\n        )}\n    </DndContext>\n  );\n};\n\nconst dropAnimationConfig: DropAnimation = {\n  sideEffects: defaultDropAnimationSideEffects({\n    styles: {\n      active: {\n        opacity: \"0.4\",\n      },\n    },\n  }),\n};\n\nconst Overlay = ({ children }: React.PropsWithChildren) => (\n  <DragOverlay\n    className=\"z-100 overflow-hidden rounded-md shadow-elevation-card-hover [&>li]:border-b-0\"\n    dropAnimation={dropAnimationConfig}\n    style={{\n      cursor: \"grabbing\",\n    }}\n  >\n    {children}\n  </DragOverlay>\n);\n\ntype SortableItemProps<TItem extends SortableBaseItem> =\n  React.PropsWithChildren<{\n    id: TItem[\"id\"];\n    className?: string;\n  }>;\n\ntype SortableItemContextValue = {\n  attributes: DraggableAttributes;\n  listeners: DraggableSyntheticListeners;\n  ref: (node: HTMLElement | null) => void;\n  isDragging: boolean;\n};\n\nconst SortableItemContext =\n  React.createContext<SortableItemContextValue | null>(null);\n\nconst useSortableItemContext = () => {\n  const context = React.useContext(SortableItemContext);\n\n  if (!context) {\n    throw new Error(\n      \"useSortableItemContext must be used within a SortableItemContext\"\n    );\n  }\n\n  return context;\n};\n\nconst SortableItem = <TItem extends SortableBaseItem>({\n  id,\n  className,\n  children,\n}: SortableItemProps<TItem>) => {\n  const {\n    attributes,\n    isDragging,\n    listeners,\n    setNodeRef,\n    setActivatorNodeRef,\n    transform,\n    transition,\n  } = useSortable({ id });\n\n  const context = React.useMemo(\n    () => ({\n      attributes,\n      listeners,\n      ref: setActivatorNodeRef,\n      isDragging,\n    }),\n    [attributes, listeners, setActivatorNodeRef, isDragging]\n  );\n\n  const style: React.CSSProperties = {\n    opacity: isDragging ? DRAG_OPACITY : undefined,\n    transform: CSS.Translate.toString(transform),\n    transition,\n  };\n\n  return (\n    <SortableItemContext.Provider value={context}>\n      <li\n        className={cn(\"flex flex-1 list-none transition-colors\", className)}\n        ref={setNodeRef}\n        style={style}\n      >\n        {children}\n      </li>\n    </SortableItemContext.Provider>\n  );\n};\n\nconst SortableDragHandle = () => {\n  const { attributes, listeners, ref } = useSortableItemContext();\n\n  return (\n    <Button\n      size=\"icon-sm\"\n      variant=\"ghost\"\n      {...attributes}\n      {...listeners}\n      className=\"cursor-grab touch-none active:cursor-grabbing\"\n      ref={ref}\n    >\n      <GripVertical className=\"size-4\" />\n    </Button>\n  );\n};\nexport { SortableList, SortableItem, SortableDragHandle };\n",
      "type": "registry:ui",
      "target": "components/ui/sortable-list.tsx"
    }
  ]
}
